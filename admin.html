<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta name="theme-color" content="#e8b4b8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Espa√ßo Cura e Cuidado</title>
    <script>
        // 1. Prote√ß√£o Imediata por Senha
        const senhaAdmin = prompt("Digite a senha de administrador para acessar o painel:");
        if (senhaAdmin !== "1234") { 
            alert("Senha incorreta! Voc√™ ser√° redirecionado.");
            window.location.href = "index.html";
        }
    </script>

    <link rel="stylesheet" href="style.css">
    <style>
        .admin-container { padding: 20px; max-width: 1000px; margin: 0 auto; }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 20px; margin-bottom: 40px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #e8b4b8; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .btn-excluir { background: #ff4d4d; color: white; border: none; padding: 8px 12px; cursor: pointer; border-radius: 4px; }
        .btn-pagamento { background: #28a745; color: white; border: none; padding: 8px 12px; cursor: pointer; border-radius: 4px; font-weight: bold; }
        h2 { color: #e8b4b8; border-bottom: 2px solid #e8b4b8; padding-bottom: 10px; margin-top: 40px; }
    </style>
</head>
<body>
    <header>
        <div class="logo">üë©‚Äçüëß Painel Administrativo</div>
        <nav class="menu">
            <a href="index.html">Voltar ao Site</a>
        </nav>
    </header>

    <section class="admin-container">
        <h2>üì¶ Gest√£o de Vendas e Pedidos</h2>
        <table>
            <thead>
                <tr>
                    <th>ID Pedido</th>
                    <th>Cliente</th>
                    <th>Produto</th>
                    <th>Valor</th>
                    <th>Status Pagamento</th>
                    <th>A√ß√£o</th>
                </tr>
            </thead>
            <tbody id="corpoVendas">
                <tr><td colspan="6">Carregando vendas...</td></tr>
            </tbody>
        </table>

        <h2>üë• Usu√°rios Cadastrados</h2>
        <table id="tabelaUsuarios">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Usu√°rio</th>
                    <th>E-mail</th>
                    <th>Senha</th> 
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="corpoTabela">
                <tr><td colspan="5">Carregando usu√°rios...</td></tr>
            </tbody>
        </table>
    </section>

    <script>
        const urlPlanilha = 'https://script.google.com/macros/s/AKfycbzfe3ywnkLckUPx1O0cIdtYKk3AoRBCUpzuO-41nIPIozagLnVDgD7GCO8vF6kvgE7n/exec';

        // FUN√á√ÉO PARA CARREGAR TUDO
        function carregarDadosAdmin() {
            carregarUsuarios();
            carregarVendas();
        }

        // Listar Usu√°rios
        function carregarUsuarios() {
            const corpo = document.getElementById('corpoTabela');
            fetch(`${urlPlanilha}?acao=listar`)
                .then(res => res.json())
                .then(dados => {
                    corpo.innerHTML = ''; 
                    dados.forEach(user => {
                        if(user.usuario.toLowerCase() !== 'admin') {
                            corpo.innerHTML += `
                                <tr>
                                    <td>${user.nome}</td>
                                    <td>${user.usuario}</td>
                                    <td>${user.email}</td>
                                    <td>${user.senha || '***'}</td>
                                    <td><button class="btn-excluir" onclick="excluirUsuario(${user.linha})">Excluir</button></td>
                                </tr>`;
                        }
                    });
                });
        }

        // Listar Vendas
        function carregarVendas() {
            const corpo = document.getElementById('corpoVendas');
            // Usamos a mesma URL, mas o Script precisa retornar a aba "Vendas"
            fetch(`${urlPlanilha}?acao=listarVendasGeral`) 
                .then(res => res.json())
                .then(vendas => {
                    corpo.innerHTML = '';
                    vendas.reverse().forEach(v => {
                        const isPendente = v.statusPag === "Aguardando Pagamento";
                        corpo.innerHTML += `
                            <tr>
                                <td>${v.id}</td>
                                <td>${v.cliente}</td>
                                <td>${v.produto}</td>
                                <td>R$ ${v.valor}</td>
                                <td style="color: ${isPendente ? 'orange' : 'green'}; font-weight: bold;">${v.statusPag}</td>
                                <td>
                                    ${isPendente ? `<button class="btn-pagamento" onclick="confirmarPagamento('${v.id}')">Dar Baixa ‚úÖ</button>` : 'Conclu√≠do'}
                                </td>
                            </tr>`;
                    });
                });
        }

        // A√ß√£o: Confirmar Pagamento
        function confirmarPagamento(id) {
            if (confirm("Confirmar recebimento do pagamento para o pedido " + id + "?")) {
                fetch(urlPlanilha, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ acao: "atualizarPagamento", idPedido: id })
                }).then(() => {
                    alert("Pagamento confirmado!");
                    carregarVendas();
                });
            }
        }

        // A√ß√£o: Excluir Usu√°rio
        function excluirUsuario(numeroLinha) {
            if (confirm("Deseja apagar este usu√°rio?")) {
                fetch(urlPlanilha, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ acao: "excluir", linha: numeroLinha })
                }).then(() => {
                    alert("Removido!");
                    carregarUsuarios(); 
                });
            }
        }

        window.onload = carregarDadosAdmin;
    </script>
</body>
</html>
