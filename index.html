<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espa√ßo Cura & Cuidado | V3.2 Fix</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primaria: #a68a78; --secundaria: #ece5df; --destaque: #8ca68e; --texto: #5a5552; --fundo: #f9f7f2; --card: #ffffff; --sucesso: #25D366; --cripto-btc: #f7931a; --cripto-usdt: #26a17b; }
        @media (prefers-color-scheme: dark) {
            :root { --fundo: #1a1817; --card: #2a2725; --texto: #e2ddd9; --secundaria: #3d3834; }
            header, .checkout-box, .produto-card, .login-box { background: var(--card) !important; color: var(--texto); }
            input, textarea { background: #333; color: white; border: 1px solid #444; }
        }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--fundo); color: var(--texto); transition: 0.3s; }
        header { background: #fff; padding: 20px; text-align: center; border-bottom: 1px solid var(--secundaria); position: sticky; top: 0; z-index: 1000; }
        .logo { font-family: 'Playfair Display', serif; font-size: 2em; color: var(--primaria); cursor: pointer; }
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
        .vitrine { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }
        .produto-card { background: #fff; border-radius: 20px; border: 1px solid var(--secundaria); overflow: hidden; }
        .produto-card img { width: 100%; height: 250px; object-fit: cover; }
        .produto-info { padding: 20px; text-align: center; }
        .preco-brl { font-size: 1.4em; font-weight: bold; color: var(--primaria); }
        .precos-cripto { margin: 10px 0; display: flex; justify-content: center; gap: 8px; }
        .selo-cripto { font-size: 0.7em; font-weight: 600; padding: 3px 8px; border-radius: 50px; }
        .selo-btc { color: var(--cripto-btc); background: rgba(247, 147, 26, 0.1); }
        .selo-usdt { color: var(--cripto-usdt); background: rgba(38, 161, 123, 0.1); }
        #modal-checkout, #modal-login { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 5000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .checkout-box, .login-box { background: white; width: 90%; max-width: 400px; padding: 30px; border-radius: 25px; text-align: center; max-height: 85vh; overflow-y: auto; }
        .btn { border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .btn-pix { background: var(--sucesso); color: white; }
        .btn-btc { background: var(--cripto-btc); color: white; }
        .secao { display: none; } .ativa { display: block; }
        #notificacao { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--texto); color: white; padding: 12px 25px; border-radius: 50px; display: none; z-index: 6000; }
        .depo-card { min-width: 250px; background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-right:15px;}
        footer { padding: 40px; text-align: center; font-size: 0.8em; opacity: 0.7; }
    </style>
</head>
<body>

<div id="notificacao"></div>

<div id="modal-login">
    <div class="login-box">
        <h3>Acesso Administrativo</h3>
        <input type="password" id="senha-admin" placeholder="Senha" style="width:80%; padding:15px; border-radius:10px; border:1px solid #ddd; text-align:center;">
        <button class="btn btn-btc" onclick="verificarSenha()">ENTRAR</button>
        <button style="background:none; border:none; margin-top:10px; cursor:pointer; color:#999" onclick="fecharLogin()">Cancelar</button>
    </div>
</div>

<div id="modal-checkout"><div class="checkout-box" id="checkout-conteudo"></div></div>

<header>
    <div class="logo" onclick="mostrar('loja')">Espa√ßo Cura & Cuidado</div>
    <nav style="margin-top:10px;">
        <span onclick="mostrar('loja')" style="cursor:pointer; margin: 0 15px; font-weight: 600; font-size: 0.8em;">LOJA</span>
        <span onclick="mostrar('carrinho')" style="cursor:pointer; margin: 0 15px; font-weight: 600; font-size: 0.8em;">BOLSA (<span id="count">0</span>)</span>
    </nav>
</header>

<div class="container">
    <div id="loja" class="secao ativa">
        <div class="vitrine" id="vitrine"></div>
        <div class="depoimento-sec" style="margin-top:50px; text-align:center;">
            <h3>Vozes do Cuidado</h3>
            <div id="lista-depoimentos" style="display:flex; overflow-x:auto; padding:20px 0;"></div>
        </div>
    </div>

    <div id="carrinho" class="secao">
        <div style="max-width:450px; margin:0 auto; background:var(--card); padding:30px; border-radius:25px; border:1px solid var(--secundaria);">
            <h3>Sua Bolsa</h3>
            <div id="lista-carrinho"></div>
            <div style="display:flex; gap:10px; margin:20px 0;">
                <input type="text" id="cupom-input" placeholder="Cupom" style="flex:1; padding:10px; border-radius:10px; border:1px solid var(--secundaria);">
                <button onclick="aplicarCupom()" style="background:var(--primaria); color:white; border:none; border-radius:10px; padding:0 15px; cursor:pointer;">OK</button>
            </div>
            <div id="msg-cupom" style="font-size:0.8em; margin-bottom:10px;"></div>
            <div id="total-carrinho" style="font-size:1.6em; color:var(--primaria); text-align:right; font-weight:bold; margin:20px 0;"></div>
            <button class="btn btn-pix" onclick="abrirCheckout('PIX')">PAGAR COM PIX</button>
            <button class="btn btn-btc" onclick="abrirCheckout('BTC')">PAGAR COM BITCOIN</button>
            <button class="btn btn-usdt" onclick="abrirCheckout('USDT')">PAGAR COM USDT</button>
        </div>
    </div>

    <div id="admin" class="secao">
        <div style="max-width:600px; margin:0 auto; background:var(--card); padding:30px; border-radius:25px; border:1px solid var(--primaria);">
            <h3>Painel Admin V3.2</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:5px;">
                <input type="text" id="cfg-pix" placeholder="Chave PIX">
                <input type="text" id="cfg-btc" placeholder="Wallet BTC">
                <input type="text" id="cfg-usdt" placeholder="Wallet USDT">
                <button class="btn btn-btc" onclick="salvarConfig()" style="margin:0">SALVAR CONFIG</button>
            </div>
            <hr>
            <h4 id="form-titulo">Gerir Itens</h4>
            <input type="hidden" id="adm-id">
            <input type="text" id="adm-nome" placeholder="Nome" style="width:94%; margin-bottom:5px;">
            <input type="number" id="adm-preco" placeholder="Pre√ßo R$" style="width:94%; margin-bottom:5px;">
            <input type="text" id="adm-foto" placeholder="Link Foto" style="width:94%; margin-bottom:5px;">
            <button class="btn btn-pix" id="btn-save-item" onclick="salvarProduto()">SALVAR ITEM</button>
            <div id="lista-admin-produtos" style="margin-top:10px;"></div>
            <hr>
            <h4>Depoimentos</h4>
            <input type="text" id="d-nome" placeholder="Cliente" style="width:94%; margin-bottom:5px;"><br>
            <textarea id="d-txt" placeholder="Texto" style="width:94%; margin-bottom:5px;"></textarea>
            <button onclick="addDepo()" class="btn btn-btc">PUBLICAR DEPOIMENTO</button>
            <div id="lista-depo-admin"></div>
            <hr>
            <h4>Cupons & Protocolos Drive</h4>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <input type="text" id="c-nome" placeholder="C√ìD" style="width:40%"><input type="number" id="c-pct" placeholder="%" style="width:20%"><input type="number" id="c-hrs" placeholder="Hrs" style="width:20%"><button onclick="addCupom()" style="width:15%; background:var(--destaque); color:white;">+</button>
            </div>
            <div id="adm-cupons-lista"></div>
            <div id="lista-pedos-admin" style="font-size:0.7em; background:#eee; padding:10px; border-radius:10px; max-height:150px; overflow-y:auto; margin-top:10px;"></div>
        </div>
    </div>
</div>

<footer><p>&copy; 2026 Espa√ßo Cura & Cuidado - espacocuraecuidado@gmail.com</p></footer>

<script>
    const SEU_TEL = "5585991561497";
    const GOOGLE_DRIVE_URL = "https://script.google.com/macros/s/AKfycbzJX1xEwkZzAi13ybppqCogsCr2PejAO7AHOLuX670Dw7oDetenq7lIdSbqybHN9p7Q/exec";

    let db = JSON.parse(localStorage.getItem('cura_v3_db')) || { produtos: [], cupons: [], depoimentos: [], pedidos: [], config: { pix:'', btc:'', usdt:'' } };
    let cart = []; let prices = { btc: 0, usdt: 0 }; let descPct = 0;

    async function obterCotacoes() {
        try {
            const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,tether&vs_currencies=brl');
            const data = await res.json();
            prices.btc = data.bitcoin.brl; prices.usdt = data.tether.brl;
            renderizar();
        } catch (e) { console.log("Erro API"); }
    }

    window.addEventListener('keydown', (e) => { if(e.shiftKey && e.altKey && e.code === 'KeyA') { e.preventDefault(); document.getElementById('modal-login').style.display='flex'; document.getElementById('senha-admin').focus(); } });
    function fecharLogin() { document.getElementById('modal-login').style.display='none'; }
    function verificarSenha() { if(document.getElementById('senha-admin').value === "Mychell1904") { fecharLogin(); mostrar('admin'); } else { alert("Senha incorreta"); } }

    function save() { localStorage.setItem('cura_v3_db', JSON.stringify(db)); }
    function mostrar(id) { document.querySelectorAll('.secao').forEach(s => s.classList.remove('ativa')); document.getElementById(id).classList.add('ativa'); }
    function notify(m) { const n = document.getElementById('notificacao'); n.innerText = m; n.style.display = 'block'; setTimeout(() => n.style.display='none', 2000); }

    function salvarProduto() {
        const id = document.getElementById('adm-id').value;
        const n = document.getElementById('adm-nome').value;
        const p = parseFloat(document.getElementById('adm-preco').value);
        const f = document.getElementById('adm-foto').value || 'https://via.placeholder.com/300';
        if(n && p) {
            if(id) { const i = db.produtos.findIndex(x => x.id == id); db.produtos[i] = {id: Number(id), nome:n, preco:p, foto:f}; }
            else { db.produtos.push({id: Date.now(), nome:n, preco:p, foto:f}); }
            save(); renderizar(); 
            document.getElementById('adm-id').value = ""; 
            document.getElementById('adm-nome').value = ""; 
            document.getElementById('adm-preco').value = "";
            document.getElementById('adm-foto').value = "";
            document.getElementById('form-titulo').innerText = "Gerir Itens"; 
            notify("Salvo!");
        }
    }

    function editarProd(id) {
        const p = db.produtos.find(x => x.id == id);
        document.getElementById('adm-id').value = p.id;
        document.getElementById('adm-nome').value = p.nome;
        document.getElementById('adm-preco').value = p.preco;
        document.getElementById('adm-foto').value = p.foto;
        document.getElementById('form-titulo').innerText = "Editando: " + p.nome;
        window.scrollTo(0,0);
    }

    function removerProd(id) { if(confirm('Excluir este item?')){ db.produtos = db.produtos.filter(x => x.id != id); save(); renderizar(); } }

    function addDepo() {
        const n = document.getElementById('d-nome').value;
        const t = document.getElementById('d-txt').value;
        if(n && t) { db.depoimentos.push({id: Date.now(), nome: n, texto: t}); save(); renderizar(); 
            document.getElementById('d-nome').value = ""; document.getElementById('d-txt').value = ""; notify("Publicado!"); }
    }

    function removerDepo(id) { db.depoimentos = db.depoimentos.filter(x => x.id != id); save(); renderizar(); }

    function addCupom() {
        const n = document.getElementById('c-nome').value.toUpperCase();
        const p = parseInt(document.getElementById('c-pct').value);
        const h = parseInt(document.getElementById('c-hrs').value) || 24;
        if(n && p) { db.cupons.push({nome:n, pct:p, expiraEm: Date.now()+(h*3600000)}); save(); renderizar(); 
            document.getElementById('c-nome').value = ""; document.getElementById('c-pct').value = ""; }
    }

    function removerCupom(i) { db.cupons.splice(i, 1); save(); renderizar(); }

    async function gerarPDF(tipo, valor, itens) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const data = new Date();
        const dataStr = data.toLocaleDateString('pt-BR') + " " + data.toLocaleTimeString('pt-BR');
        const protocolo = "CURA-" + Math.floor(100000 + Math.random() * 900000);
        const listaNomes = itens.map(i => i.nome).join(', ');

        const pedido = { protocolo, data: dataStr, valor, tipo, itens: listaNomes };
        
        fetch(GOOGLE_DRIVE_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(pedido) });
        db.pedidos.push(pedido); save(); renderizar();

        doc.setFontSize(22); doc.setTextColor(166, 138, 120); doc.text("Espaco Cura & Cuidado", 20, 30);
        doc.setFontSize(10); doc.text("PROTOCOLO: " + protocolo, 20, 50);
        doc.text("DATA: " + dataStr, 20, 60);
        doc.text("PAGAMENTO: " + tipo + " | VALOR: " + valor, 20, 70);
        doc.text("ITENS:", 20, 85);
        itens.forEach((it, i) => doc.text("- " + it.nome, 25, 95 + (i * 10)));
        
        doc.save(`comprovante-${protocolo}.pdf`);
        window.open(`https://wa.me/${SEU_TEL}?text=Ola! Comprovante gerado via ${tipo}. Protocolo: ${protocolo}`, '_blank');
    }

    function aplicarCupom() {
        const cod = document.getElementById('cupom-input').value.toUpperCase();
        const c = db.cupons.find(x => x.nome === cod);
        if(c) { descPct = c.pct; document.getElementById('msg-cupom').innerHTML = `<span style="color:green">Cupom ${c.pct}% Ativado!</span>`; renderizar(); }
        else { alert("Cupom inv√°lido ou expirado"); }
    }

    function renderizar() {
        document.getElementById('vitrine').innerHTML = db.produtos.map(p => `<div class="produto-card"><img src="${p.foto}"><div class="produto-info"><h3>${p.nome}</h3><div class="preco-brl">R$ ${p.preco.toFixed(2)}</div><div class="precos-cripto"><span class="selo-cripto selo-btc">‚Çø ${(p.preco/prices.btc).toFixed(8)}</span> <span class="selo-cripto selo-usdt">‚ÇÆ ${(p.preco/prices.usdt).toFixed(2)}</span></div><button class="btn" style="background:var(--primaria); color:white" onclick="addCart(${p.id})">RESERVAR</button></div></div>`).join('');
        
        document.getElementById('lista-depoimentos').innerHTML = db.depoimentos.map(d => `<div class="depo-card"><p>"${d.texto}"</p><strong>- ${d.nome}</strong></div>`).join('');
        
        document.getElementById('lista-depo-admin').innerHTML = db.depoimentos.map(d => `<div style="font-size:0.7em; padding:5px; border-bottom:1px solid #eee;">${d.nome} <button onclick="removerDepo(${d.id})" style="color:red; background:none; border:none; cursor:pointer;">[Excluir]</button></div>`).join('');

        document.getElementById('lista-admin-produtos').innerHTML = db.produtos.map(p => `<div style="display:flex; justify-content:space-between; font-size:0.8em; padding:5px; border-bottom:1px solid #eee;"><span>${p.nome}</span><div><button onclick="editarProd(${p.id})" style="cursor:pointer">‚úèÔ∏è</button><button onclick="removerProd(${p.id})" style="cursor:pointer; color:red">üóëÔ∏è</button></div></div>`).join('');
        
        document.getElementById('adm-cupons-lista').innerHTML = db.cupons.map((c, i) => { const m = Math.max(0, Math.floor((c.expiraEm - Date.now()) / 60000)); return `<div style="display:flex; justify-content:space-between; font-size:0.7em; background:#f4f4f4; padding:5px; margin-bottom:2px;"><span>${c.nome} (${c.pct}%) - Expira em ${Math.floor(m/60)}h ${m%60}m</span><button onclick="removerCupom(${i})" style="color:red; background:none; border:none; cursor:pointer;">‚úñ</button></div>`; }).join('');
        
        document.getElementById('lista-pedos-admin').innerHTML = "<b>Recentes:</b><br>" + db.pedidos.slice(-5).reverse().map(p => `${p.protocolo} | ${p.valor}`).join('<br>');
        
        const t = cart.reduce((a, b) => a + b.preco, 0);
        const f = t * (1 - (descPct/100));
        document.getElementById('total-carrinho').innerText = "Total: R$ " + f.toFixed(2);
        document.getElementById('count').innerText = cart.length;
        document.getElementById('lista-carrinho').innerHTML = cart.map(i => `<div style="display:flex; justify-content:space-between; font-size:0.9em"><span>${i.nome}</span><b>R$ ${i.preco.toFixed(2)}</b></div>`).join('');
    }

   function addCart(id) {
    // 1. Encontra o produto no banco de dados usando o ID
    const produtoEncontrado = db.produtos.find(p => p.id === id);
    
    if (produtoEncontrado) {
        // 2. Adiciona √† lista do carrinho
        cart.push(produtoEncontrado);
        // 3. Atualiza a tela para mostrar o n√∫mero novo na bolsa
        renderizar();
        // 4. Mostra o aviso visual "Na bolsa!"
        notify("Adicionado √† bolsa!");
    } else {
        console.error("Produto n√£o encontrado para o ID:", id);
    }
}
    
    function salvarConfig() { 
        db.config.pix = document.getElementById('cfg-pix').value; 
        db.config.btc = document.getElementById('cfg-btc').value; 
        db.config.usdt = document.getElementById('cfg-usdt').value; 
        save(); notify("Configura√ß√µes Salvas!"); 
    }

    function abrirCheckout(t) {
        if(cart.length === 0) return;
        const total = cart.reduce((a, b) => a + b.preco, 0) * (1 - (descPct/100));
        let v, k, c;
        if(t==='PIX'){ v=`R$ ${total.toFixed(2)}`; k=db.config.pix; c='var(--sucesso)'; }
        else if(t==='BTC'){ v=`‚Çø ${(total/prices.btc).toFixed(8)}`; k=db.config.btc; c='var(--cripto-btc)'; }
        else { v=`‚ÇÆ ${(total/prices.usdt).toFixed(2)}`; k=db.config.usdt; c='var(--cripto-usdt)'; }
        document.getElementById('checkout-conteudo').innerHTML = `<h3>Pagar ${t}</h3><h2 style="color:${c}">${v}</h2><div style="background:#eee; padding:10px; border-radius:10px; font-size:0.8em; word-break:break-all; cursor:pointer" onclick="navigator.clipboard.writeText('${k}'); this.innerText='COPIADO!'">${k || 'Sem carteira'}</div><button class="btn" style="background:${c}; color:white" onclick="gerarPDF('${t}', '${v}', cart)">GERAR COMPROVANTE & WHATSAPP</button><button class="btn" onclick="document.getElementById('modal-checkout').style.display='none'">CANCELAR</button>`;
        document.getElementById('modal-checkout').style.display='flex';
    }

    obterCotacoes();
</script>
</body>
</html>
